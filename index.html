<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Pelaporan BUMDes - Kementerian Desa PDTT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-6">
                    <!-- Logo Kementerian Desa -->
                    <div class="bg-white p-3 rounded-full shadow-lg">
                        <svg width="60" height="60" viewBox="0 0 100 100" class="text-green-600">
                            <circle cx="50" cy="50" r="45" fill="#10b981" stroke="#ffffff" stroke-width="3"/>
                            <text x="50" y="30" text-anchor="middle" fill="white" font-size="8" font-weight="bold">KEMENDES</text>
                            <text x="50" y="42" text-anchor="middle" fill="white" font-size="8" font-weight="bold">PDTT</text>
                            <text x="50" y="58" text-anchor="middle" fill="white" font-size="10" font-weight="bold">BUMDes</text>
                            <text x="50" y="70" text-anchor="middle" fill="white" font-size="8">2024</text>
                            <path d="M25 75 L50 65 L75 75" stroke="white" stroke-width="2" fill="none"/>
                        </svg>
                    </div>
                    
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold">Sistem Pelaporan BUMDes</h1>
                        <p class="text-green-100 mt-1 text-sm md:text-base">Kementerian Desa, Pembangunan Daerah Tertinggal dan Transmigrasi</p>
                        <p class="text-green-100 text-xs md:text-sm">BUMDes Cikahuripan Makmur Mandiri Sejahtera Cikahuripan (CMMSC)</p>
                        <p class="text-green-100 text-xs md:text-sm">Desa Cikahuripan, Kec. Klapanunggal, Kab. Bogor - Jawa Barat</p>
                        <p class="text-green-100 mt-2 text-sm">📊 Pelaporan Sesuai Standar Kementerian Desa PDTT</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-sm text-green-100">Periode Laporan</p>
                    <p class="text-xl font-semibold text-white" id="currentDate"></p>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8">
        <!-- Menu Pelaporan -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">📋 Menu Pelaporan Kementerian Desa</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button onclick="showForm('profil')" class="bg-blue-50 hover:bg-blue-100 p-4 rounded-lg text-left transition-colors border hover:border-blue-200">
                    <div class="text-2xl mb-2">🏢</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Profil BUMDes</h3>
                    <p class="text-xs text-gray-600">Data dasar dan profil BUMDes</p>
                </button>
                
                <button onclick="showForm('keuangan')" class="bg-green-50 hover:bg-green-100 p-4 rounded-lg text-left transition-colors border hover:border-green-200">
                    <div class="text-2xl mb-2">💰</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Laporan Keuangan</h3>
                    <p class="text-xs text-gray-600">Neraca, Laba Rugi, Arus Kas</p>
                </button>
                
                <button onclick="showForm('unitUsaha')" class="bg-purple-50 hover:bg-purple-100 p-4 rounded-lg text-left transition-colors border hover:border-purple-200">
                    <div class="text-2xl mb-2">🏪</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Unit Usaha</h3>
                    <p class="text-xs text-gray-600">Data unit usaha BUMDes</p>
                </button>
                
                <button onclick="showForm('laporanUnit')" class="bg-orange-50 hover:bg-orange-100 p-4 rounded-lg text-left transition-colors border hover:border-orange-200">
                    <div class="text-2xl mb-2">📊</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Laporan per Unit</h3>
                    <p class="text-xs text-gray-600">Laporan keuangan masing-masing unit</p>
                </button>
                
                <button onclick="showForm('sdm')" class="bg-yellow-50 hover:bg-yellow-100 p-4 rounded-lg text-left transition-colors border hover:border-yellow-200">
                    <div class="text-2xl mb-2">👥</div>
                    <h3 class="font-semibold text-gray-800 text-sm">SDM & Kepengurusan</h3>
                    <p class="text-xs text-gray-600">Data pengurus dan karyawan</p>
                </button>
                
                <button onclick="showForm('dampak')" class="bg-red-50 hover:bg-red-100 p-4 rounded-lg text-left transition-colors border hover:border-red-200">
                    <div class="text-2xl mb-2">📈</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Dampak Sosial Ekonomi</h3>
                    <p class="text-xs text-gray-600">Dampak terhadap masyarakat</p>
                </button>
                
                <button onclick="showForm('rekapitulasi')" class="bg-gray-50 hover:bg-gray-100 p-4 rounded-lg text-left transition-colors border hover:border-gray-200">
                    <div class="text-2xl mb-2">📊</div>
                    <h3 class="font-semibold text-gray-800 text-sm">Rekapitulasi Laporan</h3>
                    <p class="text-xs text-gray-600">Ringkasan dan export laporan</p>
                </button>
            </div>
        </div>

        <!-- Form Content Area -->
        <div id="formContent">
            <!-- Default Welcome -->
            <div id="welcome" class="bg-white rounded-xl shadow-md p-8 text-center">
                <div class="text-6xl mb-4">📋</div>
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Selamat Datang di Sistem Pelaporan BUMDes</h3>
                <p class="text-gray-600 mb-6">Pilih menu di atas untuk mulai mengisi laporan sesuai standar Kementerian Desa PDTT</p>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-sm text-blue-800">
                        <strong>📌 Petunjuk:</strong> Sistem ini dirancang khusus untuk memenuhi kebutuhan pelaporan BUMDes 
                        kepada Kementerian Desa, Pembangunan Daerah Tertinggal dan Transmigrasi sesuai dengan format standar yang ditetapkan.
                    </p>
                </div>
            </div>

            <!-- Form Profil BUMDes -->
            <div id="profil" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">🏢 Profil BUMDes</h3>
                    
                    <form onsubmit="saveProfilData(event)" class="space-y-6">
                        <!-- Data Dasar -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-blue-800 mb-4">📋 Data Dasar BUMDes</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama BUMDes</label>
                                    <input type="text" id="namaBumdes" value="BUMDes Cikahuripan Makmur Mandiri Sejahtera Cikahuripan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nama Desa</label>
                                    <input type="text" id="namaDesa" value="Cikahuripan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kecamatan</label>
                                    <input type="text" id="kecamatan" value="Klapanunggal" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kabupaten/Kota</label>
                                    <input type="text" id="kabupaten" value="Bogor" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Provinsi</label>
                                    <input type="text" id="provinsi" value="Jawa Barat" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal Berdiri</label>
                                    <input type="date" id="tanggalBerdiri" value="2020-03-15" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">No. SK Pendirian</label>
                                    <input type="text" id="noSK" value="SK.001/BUMDes/2020" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Modal Awal (Rp)</label>
                                    <input type="number" id="modalAwal" value="500000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <!-- Kontak & Alamat -->
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-green-800 mb-4">📍 Alamat & Kontak</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Alamat Lengkap</label>
                                    <textarea id="alamatLengkap" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>Jl. Klapanunggal - Bojong, Kp. Palahlar RT. 019/008, Desa Cikahuripan, Kec. Klapanunggal, Kab. Bogor, Jawa Barat</textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">No. Telepon</label>
                                    <input type="tel" id="noTelepon" value="082125415593" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="email" value="cmms.cikahuripan@gmail.com" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <!-- Status Operasional -->
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-purple-800 mb-4">⚡ Status Operasional</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Status BUMDes</label>
                                    <select id="statusBumdes" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        <option value="aktif">Aktif</option>
                                        <option value="tidak_aktif">Tidak Aktif</option>
                                        <option value="pembubaran">Dalam Proses Pembubaran</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Unit Usaha</label>
                                    <input type="number" id="jumlahUnit" value="7" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Karyawan</label>
                                    <input type="number" id="jumlahKaryawan" value="25" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                💾 Simpan Data Profil
                            </button>
                            <button type="button" onclick="exportProfilData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Form Laporan Keuangan -->
            <div id="keuangan" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">💰 Laporan Keuangan</h3>
                    
                    <form onsubmit="saveKeuanganData(event)" class="space-y-6">
                        <!-- Neraca -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-blue-800 mb-4">📊 Neraca Keuangan</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-semibold text-blue-700 mb-3">ASET</h5>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Kas dan Setara Kas (Rp)</label>
                                            <input type="number" id="kas" value="125000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Piutang Usaha (Rp)</label>
                                            <input type="number" id="piutang" value="25000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Persediaan (Rp)</label>
                                            <input type="number" id="persediaan" value="50000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Aset Tetap (Rp)</label>
                                            <input type="number" id="asetTetap" value="450000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-blue-700 mb-3">KEWAJIBAN & EKUITAS</h5>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Hutang Usaha (Rp)</label>
                                            <input type="number" id="hutangUsaha" value="75000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Hutang Bank (Rp)</label>
                                            <input type="number" id="hutangBank" value="25000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Modal Disetor (Rp)</label>
                                            <input type="number" id="modalDisetor" value="500000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Laba Ditahan (Rp)</label>
                                            <input type="number" id="labaDitahan" value="50000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Laba Rugi -->
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-green-800 mb-4">📈 Laporan Laba Rugi</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Pendapatan (Rp)</label>
                                    <input type="number" id="totalPendapatan" value="555000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Harga Pokok Penjualan (Rp)</label>
                                    <input type="number" id="hpp" value="300000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Operasional (Rp)</label>
                                    <input type="number" id="biayaOperasional" value="125000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Administrasi (Rp)</label>
                                    <input type="number" id="biayaAdmin" value="45000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Pendapatan Lain-lain (Rp)</label>
                                    <input type="number" id="pendapatanLain" value="15000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Beban Pajak (Rp)</label>
                                    <input type="number" id="bebanPajak" value="10000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-white rounded-lg border">
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-lg">Laba Bersih:</span>
                                    <span class="font-bold text-lg text-green-600" id="labaBersih">Rp 90.000.000</span>
                                </div>
                            </div>
                        </div>

                        <!-- Arus Kas -->
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-purple-800 mb-4">💸 Laporan Arus Kas</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <h5 class="font-semibold text-purple-700 mb-3">Aktivitas Operasi</h5>
                                    <div class="space-y-2">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Penerimaan dari Pelanggan (Rp)</label>
                                            <input type="number" id="penerimaanPelanggan" value="520000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pembayaran ke Pemasok (Rp)</label>
                                            <input type="number" id="pembayaranPemasok" value="280000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pembayaran Gaji (Rp)</label>
                                            <input type="number" id="pembayaranGaji" value="120000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-purple-700 mb-3">Aktivitas Investasi</h5>
                                    <div class="space-y-2">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pembelian Aset Tetap (Rp)</label>
                                            <input type="number" id="pembelianAset" value="50000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Penjualan Aset (Rp)</label>
                                            <input type="number" id="penjualanAset" value="5000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-purple-700 mb-3">Aktivitas Pendanaan</h5>
                                    <div class="space-y-2">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Penerimaan Pinjaman (Rp)</label>
                                            <input type="number" id="penerimaanPinjaman" value="25000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pembayaran Pinjaman (Rp)</label>
                                            <input type="number" id="pembayaranPinjaman" value="15000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Dividen Dibayar (Rp)</label>
                                            <input type="number" id="dividenDibayar" value="20000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                💾 Simpan Laporan Keuangan
                            </button>
                            <button type="button" onclick="exportKeuanganData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Excel
                            </button>
                            <button type="button" onclick="hitungLabaBersih()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg">
                                🧮 Hitung Otomatis
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Form Unit Usaha -->
            <div id="unitUsaha" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">🏪 Data Unit Usaha</h3>
                    
                    <form onsubmit="saveUnitUsahaData(event)" class="space-y-6">
                        <div id="unitUsahaContainer">
                            <!-- Unit Usaha 1 -->
                            <div class="bg-blue-50 p-6 rounded-lg unit-usaha-item">
                                <div class="flex justify-between items-center mb-4">
                                    <h4 class="text-lg font-bold text-blue-800">Unit Usaha #1</h4>
                                    <button type="button" onclick="removeUnit(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                        🗑️ Hapus
                                    </button>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Unit Usaha</label>
                                        <input type="text" name="namaUnit" value="Unit Internet" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Usaha</label>
                                        <select name="jenisUsaha" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                            <option value="perdagangan">Perdagangan</option>
                                            <option value="jasa" selected>Jasa</option>
                                            <option value="produksi">Produksi</option>
                                            <option value="simpan_pinjam">Simpan Pinjam</option>
                                            <option value="lainnya">Lainnya</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Modal Awal (Rp)</label>
                                        <input type="number" name="modalAwalUnit" value="100000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Omzet per Bulan (Rp)</label>
                                        <input type="number" name="omzetBulanan" value="125000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Karyawan</label>
                                        <input type="number" name="jumlahKaryawanUnit" value="5" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Status Operasional</label>
                                        <select name="statusOperasional" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                            <option value="aktif" selected>Aktif</option>
                                            <option value="tidak_aktif">Tidak Aktif</option>
                                            <option value="musiman">Musiman</option>
                                        </select>
                                    </div>
                                    <div class="md:col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi Usaha</label>
                                        <textarea name="deskripsiUsaha" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>Penyedia layanan internet untuk masyarakat desa dengan teknologi fiber optik</textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="button" onclick="addNewUnit()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                ➕ Tambah Unit Usaha
                            </button>
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                💾 Simpan Data Unit Usaha
                            </button>
                            <button type="button" onclick="exportUnitUsahaData()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Form SDM & Kepengurusan -->
            <div id="sdm" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">👥 SDM & Kepengurusan</h3>
                    
                    <form onsubmit="saveSDMData(event)" class="space-y-6">
                        <!-- Data Pengurus -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-blue-800 mb-4">👔 Data Pengurus BUMDes</h4>
                            <div id="pengurusContainer">
                                <div class="pengurus-item bg-white p-4 rounded-lg mb-4">
                                    <div class="flex justify-between items-center mb-3">
                                        <h5 class="font-semibold text-gray-800">Pengurus #1</h5>
                                        <button type="button" onclick="removePengurus(this)" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm">
                                            🗑️ Hapus
                                        </button>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                                            <input type="text" name="namaPengurus" value="Budi Santoso" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Jabatan</label>
                                            <select name="jabatanPengurus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                                <option value="direktur" selected>Direktur</option>
                                                <option value="komisaris">Komisaris</option>
                                                <option value="sekretaris">Sekretaris</option>
                                                <option value="bendahara">Bendahara</option>
                                                <option value="manager">Manager</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Pendidikan Terakhir</label>
                                            <select name="pendidikanPengurus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                                <option value="sd">SD</option>
                                                <option value="smp">SMP</option>
                                                <option value="sma">SMA/SMK</option>
                                                <option value="diploma" selected>Diploma</option>
                                                <option value="s1">S1</option>
                                                <option value="s2">S2</option>
                                                <option value="s3">S3</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" onclick="addNewPengurus()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
                                ➕ Tambah Pengurus
                            </button>
                        </div>

                        <!-- Data Karyawan -->
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-green-800 mb-4">👷 Data Karyawan</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Karyawan Tetap</label>
                                    <input type="number" id="karyawanTetap" value="15" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Karyawan Kontrak</label>
                                    <input type="number" id="karyawanKontrak" value="8" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Karyawan Laki-laki</label>
                                    <input type="number" id="karyawanLaki" value="14" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Karyawan Perempuan</label>
                                    <input type="number" id="karyawanPerempuan" value="9" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <!-- Pelatihan & Pengembangan -->
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-purple-800 mb-4">📚 Pelatihan & Pengembangan SDM</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Pelatihan yang Diikuti (per tahun)</label>
                                    <input type="number" id="jumlahPelatihan" value="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Anggaran Pelatihan (Rp/tahun)</label>
                                    <input type="number" id="anggaranPelatihan" value="25000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Pelatihan yang Diikuti</label>
                                    <textarea id="jenisPelatihan" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>Pelatihan manajemen keuangan, pelatihan teknologi informasi, pelatihan customer service, pelatihan kepemimpinan, pelatihan kewirausahaan, pelatihan digital marketing</textarea>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                💾 Simpan Data SDM
                            </button>
                            <button type="button" onclick="exportSDMData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Form Laporan per Unit -->
            <div id="laporanUnit" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">📊 Laporan Keuangan per Unit Usaha</h3>
                    
                    <!-- Unit Selector -->
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-bold text-blue-800">Pilih Unit Usaha</h4>
                            <button type="button" onclick="refreshUnitList()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">
                                🔄 Refresh Daftar Unit
                            </button>
                        </div>
                        <select id="selectedUnit" onchange="loadUnitReport()" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                            <option value="">-- Pilih Unit Usaha --</option>
                        </select>
                    </div>

                    <!-- Unit Report Form -->
                    <div id="unitReportForm" class="hidden">
                        <form onsubmit="saveUnitReport(event)" class="space-y-6">
                            <!-- Info Unit -->
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="text-lg font-bold text-gray-800 mb-3">ℹ️ Informasi Unit</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Unit</label>
                                        <input type="text" id="unitNama" readonly class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Jenis Usaha</label>
                                        <input type="text" id="unitJenis" readonly class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Periode Laporan</label>
                                        <input type="month" id="periodeUnit" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Pendapatan Unit -->
                            <div class="bg-green-50 p-6 rounded-lg">
                                <h4 class="text-lg font-bold text-green-800 mb-4">💰 Pendapatan Unit</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Penjualan/Omzet (Rp)</label>
                                        <input type="number" id="unitPenjualan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Pendapatan Jasa (Rp)</label>
                                        <input type="number" id="unitPendapatanJasa" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Pendapatan Lain-lain (Rp)</label>
                                        <input type="number" id="unitPendapatanLain" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Total Pendapatan (Rp)</label>
                                        <input type="number" id="unitTotalPendapatan" readonly class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100 font-bold">
                                    </div>
                                </div>
                            </div>

                            <!-- Biaya Unit -->
                            <div class="bg-red-50 p-6 rounded-lg">
                                <h4 class="text-lg font-bold text-red-800 mb-4">💸 Biaya Operasional Unit</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Harga Pokok Penjualan (Rp)</label>
                                        <input type="number" id="unitHPP" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Gaji Karyawan (Rp)</label>
                                        <input type="number" id="unitBiayaGaji" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Operasional (Rp)</label>
                                        <input type="number" id="unitBiayaOp" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Administrasi (Rp)</label>
                                        <input type="number" id="unitBiayaAdmin" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Biaya Pemasaran (Rp)</label>
                                        <input type="number" id="unitBiayaPemasaran" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Total Biaya (Rp)</label>
                                        <input type="number" id="unitTotalBiaya" readonly class="w-full border border-gray-300 rounded-lg px-3 py-2 bg-gray-100 font-bold">
                                    </div>
                                </div>
                            </div>

                            <!-- Laba Rugi Unit -->
                            <div class="bg-blue-50 p-6 rounded-lg">
                                <h4 class="text-lg font-bold text-blue-800 mb-4">📈 Laba Rugi Unit</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div class="bg-white p-4 rounded-lg text-center">
                                        <h5 class="font-semibold text-gray-700 mb-2">Laba Kotor</h5>
                                        <div class="text-2xl font-bold text-green-600" id="unitLabaKotor">Rp 0</div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg text-center">
                                        <h5 class="font-semibold text-gray-700 mb-2">Laba Operasional</h5>
                                        <div class="text-2xl font-bold text-blue-600" id="unitLabaOp">Rp 0</div>
                                    </div>
                                    <div class="bg-white p-4 rounded-lg text-center">
                                        <h5 class="font-semibold text-gray-700 mb-2">Laba Bersih</h5>
                                        <div class="text-2xl font-bold text-purple-600" id="unitLabaBersih">Rp 0</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Aset Unit -->
                            <div class="bg-yellow-50 p-6 rounded-lg">
                                <h4 class="text-lg font-bold text-yellow-800 mb-4">🏦 Aset Unit</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Kas Unit (Rp)</label>
                                        <input type="number" id="unitKas" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Piutang Unit (Rp)</label>
                                        <input type="number" id="unitPiutang" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Persediaan Unit (Rp)</label>
                                        <input type="number" id="unitPersediaan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Aset Tetap Unit (Rp)</label>
                                        <input type="number" id="unitAsetTetap" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Catatan -->
                            <div class="bg-purple-50 p-6 rounded-lg">
                                <h4 class="text-lg font-bold text-purple-800 mb-4">📝 Catatan & Analisis</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Kinerja Unit</label>
                                        <textarea id="unitCatatan" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="Masukkan catatan tentang kinerja unit usaha ini..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Rencana Pengembangan</label>
                                        <textarea id="unitRencana" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" placeholder="Rencana pengembangan unit usaha ke depan..."></textarea>
                                    </div>
                                </div>
                            </div>

                            <div class="flex space-x-4">
                                <button type="button" onclick="hitungLabaUnit()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg">
                                    🧮 Hitung Otomatis
                                </button>
                                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                    💾 Simpan Laporan Unit
                                </button>
                                <button type="button" onclick="exportUnitReport()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                    📊 Export Laporan Unit
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Daftar Laporan Unit -->
                    <div class="bg-gray-50 p-6 rounded-lg mt-6">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">📋 Daftar Laporan Unit yang Tersimpan</h4>
                        <div id="unitReportsList">
                            <p class="text-gray-600 text-center py-4">Belum ada laporan unit yang tersimpan</p>
                        </div>
                        <div class="mt-4 flex space-x-4">
                            <button onclick="exportAllUnitReports()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Semua Laporan Unit
                            </button>
                            <button onclick="generateConsolidatedReport()" class="bg-teal-500 hover:bg-teal-600 text-white px-6 py-2 rounded-lg">
                                📈 Laporan Konsolidasi
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Dampak Sosial Ekonomi -->
            <div id="dampak" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">📈 Dampak Sosial Ekonomi</h3>
                    
                    <form onsubmit="saveDampakData(event)" class="space-y-6">
                        <!-- Dampak Ekonomi -->
                        <div class="bg-green-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-green-800 mb-4">💰 Dampak Ekonomi</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Lapangan Kerja yang Tercipta</label>
                                    <input type="number" id="lapanganKerja" value="25" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Peningkatan Pendapatan Masyarakat (%)</label>
                                    <input type="number" id="peningkatanPendapatan" value="15" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Kontribusi PADes (Rp/tahun)</label>
                                    <input type="number" id="kontribusiPADes" value="50000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah UMKM yang Bermitra</label>
                                    <input type="number" id="umkmBermitra" value="35" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <!-- Dampak Sosial -->
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-blue-800 mb-4">🤝 Dampak Sosial</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Keluarga yang Terlayani</label>
                                    <input type="number" id="keluargaTerlayani" value="450" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Program CSR yang Dilaksanakan</label>
                                    <input type="number" id="programCSR" value="8" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Anggaran CSR (Rp/tahun)</label>
                                    <input type="number" id="anggaranCSR" value="75000000" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Tingkat Kepuasan Masyarakat (%)</label>
                                    <input type="number" id="kepuasanMasyarakat" value="85" min="0" max="100" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi Program CSR</label>
                                    <textarea id="deskripsiCSR" rows="4" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>1. Program bantuan pendidikan untuk anak kurang mampu
2. Pembangunan fasilitas umum (jalan, jembatan)
3. Program pelatihan keterampilan untuk ibu-ibu
4. Bantuan modal usaha mikro
5. Program kesehatan masyarakat
6. Pemberdayaan kelompok tani
7. Program lingkungan hidup
8. Bantuan bencana alam</textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Dampak Lingkungan -->
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <h4 class="text-lg font-bold text-purple-800 mb-4">🌱 Dampak Lingkungan</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Program Pengelolaan Sampah</label>
                                    <select id="programSampah" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        <option value="ada" selected>Ada</option>
                                        <option value="tidak_ada">Tidak Ada</option>
                                        <option value="dalam_perencanaan">Dalam Perencanaan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Volume Sampah Dikelola (Ton/bulan)</label>
                                    <input type="number" step="0.1" id="volumeSampah" value="15.5" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Program Penghijauan</label>
                                    <select id="programHijau" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                        <option value="ada" selected>Ada</option>
                                        <option value="tidak_ada">Tidak Ada</option>
                                        <option value="dalam_perencanaan">Dalam Perencanaan</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Pohon Ditanam (per tahun)</label>
                                    <input type="number" id="jumlahPohon" value="500" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                                </div>
                            </div>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                                💾 Simpan Data Dampak
                            </button>
                            <button type="button" onclick="exportDampakData()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                                📊 Export Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Rekapitulasi Laporan -->
            <div id="rekapitulasi" class="form-section hidden">
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">📊 Rekapitulasi Laporan</h3>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-blue-50 p-6 rounded-lg text-center">
                            <div class="text-3xl mb-2">🏢</div>
                            <h4 class="font-bold text-blue-800">Status BUMDes</h4>
                            <p class="text-2xl font-bold text-blue-600">Aktif</p>
                            <p class="text-sm text-blue-600">7 Unit Usaha</p>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg text-center">
                            <div class="text-3xl mb-2">💰</div>
                            <h4 class="font-bold text-green-800">Laba Bersih</h4>
                            <p class="text-2xl font-bold text-green-600">Rp 90 Juta</p>
                            <p class="text-sm text-green-600">Per Tahun</p>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg text-center">
                            <div class="text-3xl mb-2">👥</div>
                            <h4 class="font-bold text-purple-800">Tenaga Kerja</h4>
                            <p class="text-2xl font-bold text-purple-600">25 Orang</p>
                            <p class="text-sm text-purple-600">Karyawan Aktif</p>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg text-center">
                            <div class="text-3xl mb-2">🤝</div>
                            <h4 class="font-bold text-yellow-800">Dampak Sosial</h4>
                            <p class="text-2xl font-bold text-yellow-600">450 KK</p>
                            <p class="text-sm text-yellow-600">Keluarga Terlayani</p>
                        </div>
                    </div>

                    <!-- Export Options -->
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <h4 class="text-xl font-bold text-gray-800 mb-4">📤 Export Laporan Lengkap</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <button onclick="exportLaporanLengkap()" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center">
                                <div class="text-2xl mb-2">📊</div>
                                <div class="font-semibold">Export Excel Lengkap</div>
                                <div class="text-sm opacity-90">Semua data dalam satu file</div>
                            </button>
                            <button onclick="exportLaporanPDF()" class="bg-red-500 hover:bg-red-600 text-white p-4 rounded-lg text-center">
                                <div class="text-2xl mb-2">📄</div>
                                <div class="font-semibold">Export PDF Lengkap</div>
                                <div class="text-sm opacity-90">Format laporan resmi</div>
                            </button>
                            <button onclick="exportFormatKemendes()" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center">
                                <div class="text-2xl mb-2">🏛️</div>
                                <div class="font-semibold">Format Kemendes</div>
                                <div class="text-sm opacity-90">Sesuai standar kementerian</div>
                            </button>
                        </div>
                    </div>

                    <!-- Validasi Data -->
                    <div class="bg-yellow-50 p-6 rounded-lg mt-6">
                        <h4 class="text-xl font-bold text-yellow-800 mb-4">✅ Validasi Data</h4>
                        <div id="validationResults">
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <span class="text-green-600 mr-2">✅</span>
                                    <span>Data Profil BUMDes: Lengkap</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-green-600 mr-2">✅</span>
                                    <span>Laporan Keuangan: Lengkap</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-green-600 mr-2">✅</span>
                                    <span>Data Unit Usaha: Lengkap</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-green-600 mr-2">✅</span>
                                    <span>Data SDM: Lengkap</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="text-green-600 mr-2">✅</span>
                                    <span>Data Dampak Sosial Ekonomi: Lengkap</span>
                                </div>
                            </div>
                        </div>
                        <button onclick="validateAllData()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg mt-4">
                            🔍 Validasi Ulang Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-6 text-center">
            <p class="text-gray-300">© 2024 Sistem Pelaporan BUMDes - Kementerian Desa, Pembangunan Daerah Tertinggal dan Transmigrasi</p>
            <p class="text-gray-400 text-sm mt-2">BUMDes Cikahuripan Makmur Mandiri Sejahtera Cikahuripan (CMMSC)</p>
            <p class="text-gray-400 text-sm">Desa Cikahuripan, Kec. Klapanunggal, Kab. Bogor - Jawa Barat</p>
        </div>
    </footer>

    <script>
        // Global variables
        let reportData = JSON.parse(localStorage.getItem('bumdesKemendesReports')) || {};
        let unitCounter = 1;
        let pengurusCounter = 1;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Sistem Pelaporan BUMDes Kemendes dimuat');
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('id-ID');
        });

        // Show form function
        function showForm(formId) {
            console.log('📋 Menampilkan form:', formId);
            
            // Hide all forms
            const allForms = document.querySelectorAll('.form-section');
            allForms.forEach(form => form.classList.add('hidden'));
            
            // Hide welcome
            const welcome = document.getElementById('welcome');
            if (welcome) welcome.classList.add('hidden');
            
            // Show selected form
            const selectedForm = document.getElementById(formId);
            if (selectedForm) {
                selectedForm.classList.remove('hidden');
                console.log('✅ Form berhasil ditampilkan:', formId);
            } else {
                console.log('❌ Form tidak ditemukan:', formId);
            }
        }

        // Save functions for each form
        function saveProfilData(event) {
            event.preventDefault();
            
            const data = {
                namaBumdes: document.getElementById('namaBumdes').value,
                namaDesa: document.getElementById('namaDesa').value,
                kecamatan: document.getElementById('kecamatan').value,
                kabupaten: document.getElementById('kabupaten').value,
                provinsi: document.getElementById('provinsi').value,
                tanggalBerdiri: document.getElementById('tanggalBerdiri').value,
                noSK: document.getElementById('noSK').value,
                modalAwal: document.getElementById('modalAwal').value,
                alamatLengkap: document.getElementById('alamatLengkap').value,
                noTelepon: document.getElementById('noTelepon').value,
                email: document.getElementById('email').value,
                statusBumdes: document.getElementById('statusBumdes').value,
                jumlahUnit: document.getElementById('jumlahUnit').value,
                jumlahKaryawan: document.getElementById('jumlahKaryawan').value
            };
            
            reportData.profil = data;
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            alert('💾 Data Profil BUMDes berhasil disimpan!');
        }

        function saveKeuanganData(event) {
            event.preventDefault();
            
            const data = {
                kas: document.getElementById('kas').value,
                piutang: document.getElementById('piutang').value,
                persediaan: document.getElementById('persediaan').value,
                asetTetap: document.getElementById('asetTetap').value,
                hutangUsaha: document.getElementById('hutangUsaha').value,
                hutangBank: document.getElementById('hutangBank').value,
                modalDisetor: document.getElementById('modalDisetor').value,
                labaDitahan: document.getElementById('labaDitahan').value,
                totalPendapatan: document.getElementById('totalPendapatan').value,
                hpp: document.getElementById('hpp').value,
                biayaOperasional: document.getElementById('biayaOperasional').value,
                biayaAdmin: document.getElementById('biayaAdmin').value,
                pendapatanLain: document.getElementById('pendapatanLain').value,
                bebanPajak: document.getElementById('bebanPajak').value,
                penerimaanPelanggan: document.getElementById('penerimaanPelanggan').value,
                pembayaranPemasok: document.getElementById('pembayaranPemasok').value,
                pembayaranGaji: document.getElementById('pembayaranGaji').value,
                pembelianAset: document.getElementById('pembelianAset').value,
                penjualanAset: document.getElementById('penjualanAset').value,
                penerimaanPinjaman: document.getElementById('penerimaanPinjaman').value,
                pembayaranPinjaman: document.getElementById('pembayaranPinjaman').value,
                dividenDibayar: document.getElementById('dividenDibayar').value
            };
            
            reportData.keuangan = data;
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            alert('💾 Laporan Keuangan berhasil disimpan!');
        }

        function saveUnitUsahaData(event) {
            event.preventDefault();
            
            const unitItems = document.querySelectorAll('.unit-usaha-item');
            const units = [];
            
            unitItems.forEach(item => {
                const unit = {
                    namaUnit: item.querySelector('[name="namaUnit"]').value,
                    jenisUsaha: item.querySelector('[name="jenisUsaha"]').value,
                    modalAwalUnit: item.querySelector('[name="modalAwalUnit"]').value,
                    omzetBulanan: item.querySelector('[name="omzetBulanan"]').value,
                    jumlahKaryawanUnit: item.querySelector('[name="jumlahKaryawanUnit"]').value,
                    statusOperasional: item.querySelector('[name="statusOperasional"]').value,
                    deskripsiUsaha: item.querySelector('[name="deskripsiUsaha"]').value
                };
                units.push(unit);
            });
            
            reportData.unitUsaha = units;
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            alert('💾 Data Unit Usaha berhasil disimpan!');
        }

        function saveSDMData(event) {
            event.preventDefault();
            
            const pengurusItems = document.querySelectorAll('.pengurus-item');
            const pengurus = [];
            
            pengurusItems.forEach(item => {
                const pengurusData = {
                    namaPengurus: item.querySelector('[name="namaPengurus"]').value,
                    jabatanPengurus: item.querySelector('[name="jabatanPengurus"]').value,
                    pendidikanPengurus: item.querySelector('[name="pendidikanPengurus"]').value
                };
                pengurus.push(pengurusData);
            });
            
            const data = {
                pengurus: pengurus,
                karyawanTetap: document.getElementById('karyawanTetap').value,
                karyawanKontrak: document.getElementById('karyawanKontrak').value,
                karyawanLaki: document.getElementById('karyawanLaki').value,
                karyawanPerempuan: document.getElementById('karyawanPerempuan').value,
                jumlahPelatihan: document.getElementById('jumlahPelatihan').value,
                anggaranPelatihan: document.getElementById('anggaranPelatihan').value,
                jenisPelatihan: document.getElementById('jenisPelatihan').value
            };
            
            reportData.sdm = data;
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            alert('💾 Data SDM berhasil disimpan!');
        }

        function saveDampakData(event) {
            event.preventDefault();
            
            const data = {
                lapanganKerja: document.getElementById('lapanganKerja').value,
                peningkatanPendapatan: document.getElementById('peningkatanPendapatan').value,
                kontribusiPADes: document.getElementById('kontribusiPADes').value,
                umkmBermitra: document.getElementById('umkmBermitra').value,
                keluargaTerlayani: document.getElementById('keluargaTerlayani').value,
                programCSR: document.getElementById('programCSR').value,
                anggaranCSR: document.getElementById('anggaranCSR').value,
                kepuasanMasyarakat: document.getElementById('kepuasanMasyarakat').value,
                deskripsiCSR: document.getElementById('deskripsiCSR').value,
                programSampah: document.getElementById('programSampah').value,
                volumeSampah: document.getElementById('volumeSampah').value,
                programHijau: document.getElementById('programHijau').value,
                jumlahPohon: document.getElementById('jumlahPohon').value
            };
            
            reportData.dampak = data;
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            alert('💾 Data Dampak Sosial Ekonomi berhasil disimpan!');
        }

        // Dynamic form functions
        function addNewUnit() {
            unitCounter++;
            const container = document.getElementById('unitUsahaContainer');
            const newUnit = document.createElement('div');
            newUnit.className = 'bg-blue-50 p-6 rounded-lg unit-usaha-item';
            newUnit.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-bold text-blue-800">Unit Usaha #${unitCounter}</h4>
                    <button type="button" onclick="removeUnit(this)" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                        🗑️ Hapus
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Unit Usaha</label>
                        <input type="text" name="namaUnit" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Usaha</label>
                        <select name="jenisUsaha" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                            <option value="perdagangan">Perdagangan</option>
                            <option value="jasa">Jasa</option>
                            <option value="produksi">Produksi</option>
                            <option value="simpan_pinjam">Simpan Pinjam</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Modal Awal (Rp)</label>
                        <input type="number" name="modalAwalUnit" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Omzet per Bulan (Rp)</label>
                        <input type="number" name="omzetBulanan" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Karyawan</label>
                        <input type="number" name="jumlahKaryawanUnit" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status Operasional</label>
                        <select name="statusOperasional" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                            <option value="aktif">Aktif</option>
                            <option value="tidak_aktif">Tidak Aktif</option>
                            <option value="musiman">Musiman</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi Usaha</label>
                        <textarea name="deskripsiUsaha" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required></textarea>
                    </div>
                </div>
            `;
            container.appendChild(newUnit);
        }

        function removeUnit(button) {
            button.closest('.unit-usaha-item').remove();
        }

        function addNewPengurus() {
            pengurusCounter++;
            const container = document.getElementById('pengurusContainer');
            const newPengurus = document.createElement('div');
            newPengurus.className = 'pengurus-item bg-white p-4 rounded-lg mb-4';
            newPengurus.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h5 class="font-semibold text-gray-800">Pengurus #${pengurusCounter}</h5>
                    <button type="button" onclick="removePengurus(this)" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm">
                        🗑️ Hapus
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Nama Lengkap</label>
                        <input type="text" name="namaPengurus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Jabatan</label>
                        <select name="jabatanPengurus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                            <option value="direktur">Direktur</option>
                            <option value="komisaris">Komisaris</option>
                            <option value="sekretaris">Sekretaris</option>
                            <option value="bendahara">Bendahara</option>
                            <option value="manager">Manager</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Pendidikan Terakhir</label>
                        <select name="pendidikanPengurus" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:border-blue-500" required>
                            <option value="sd">SD</option>
                            <option value="smp">SMP</option>
                            <option value="sma">SMA/SMK</option>
                            <option value="diploma">Diploma</option>
                            <option value="s1">S1</option>
                            <option value="s2">S2</option>
                            <option value="s3">S3</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(newPengurus);
        }

        function removePengurus(button) {
            button.closest('.pengurus-item').remove();
        }

        // Calculation functions
        function hitungLabaBersih() {
            const pendapatan = parseInt(document.getElementById('totalPendapatan').value) || 0;
            const hpp = parseInt(document.getElementById('hpp').value) || 0;
            const biayaOp = parseInt(document.getElementById('biayaOperasional').value) || 0;
            const biayaAdmin = parseInt(document.getElementById('biayaAdmin').value) || 0;
            const pendapatanLain = parseInt(document.getElementById('pendapatanLain').value) || 0;
            const pajak = parseInt(document.getElementById('bebanPajak').value) || 0;
            
            const labaBersih = pendapatan - hpp - biayaOp - biayaAdmin + pendapatanLain - pajak;
            
            document.getElementById('labaBersih').textContent = 'Rp ' + labaBersih.toLocaleString('id-ID');
            
            alert('🧮 Laba bersih berhasil dihitung: Rp ' + labaBersih.toLocaleString('id-ID'));
        }

        // Export functions
        function exportProfilData() {
            const data = reportData.profil || {};
            const ws_data = [
                ['PROFIL BUMDes - KEMENTERIAN DESA PDTT'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['DATA DASAR BUMDES'],
                ['Nama BUMDes', data.namaBumdes || ''],
                ['Nama Desa', data.namaDesa || ''],
                ['Kecamatan', data.kecamatan || ''],
                ['Kabupaten/Kota', data.kabupaten || ''],
                ['Provinsi', data.provinsi || ''],
                ['Tanggal Berdiri', data.tanggalBerdiri || ''],
                ['No. SK Pendirian', data.noSK || ''],
                ['Modal Awal (Rp)', data.modalAwal || ''],
                [''],
                ['ALAMAT & KONTAK'],
                ['Alamat Lengkap', data.alamatLengkap || ''],
                ['No. Telepon', data.noTelepon || ''],
                ['Email', data.email || ''],
                [''],
                ['STATUS OPERASIONAL'],
                ['Status BUMDes', data.statusBumdes || ''],
                ['Jumlah Unit Usaha', data.jumlahUnit || ''],
                ['Jumlah Karyawan', data.jumlahKaryawan || '']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Profil BUMDes');
            XLSX.writeFile(wb, 'Profil_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📊 Data Profil BUMDes berhasil di-export!');
        }

        function exportKeuanganData() {
            const data = reportData.keuangan || {};
            const ws_data = [
                ['LAPORAN KEUANGAN BUMDes - KEMENTERIAN DESA PDTT'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['NERACA KEUANGAN'],
                ['ASET'],
                ['Kas dan Setara Kas (Rp)', data.kas || ''],
                ['Piutang Usaha (Rp)', data.piutang || ''],
                ['Persediaan (Rp)', data.persediaan || ''],
                ['Aset Tetap (Rp)', data.asetTetap || ''],
                [''],
                ['KEWAJIBAN & EKUITAS'],
                ['Hutang Usaha (Rp)', data.hutangUsaha || ''],
                ['Hutang Bank (Rp)', data.hutangBank || ''],
                ['Modal Disetor (Rp)', data.modalDisetor || ''],
                ['Laba Ditahan (Rp)', data.labaDitahan || ''],
                [''],
                ['LAPORAN LABA RUGI'],
                ['Total Pendapatan (Rp)', data.totalPendapatan || ''],
                ['Harga Pokok Penjualan (Rp)', data.hpp || ''],
                ['Biaya Operasional (Rp)', data.biayaOperasional || ''],
                ['Biaya Administrasi (Rp)', data.biayaAdmin || ''],
                ['Pendapatan Lain-lain (Rp)', data.pendapatanLain || ''],
                ['Beban Pajak (Rp)', data.bebanPajak || '']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Keuangan');
            XLSX.writeFile(wb, 'Laporan_Keuangan_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📊 Laporan Keuangan berhasil di-export!');
        }

        function exportUnitUsahaData() {
            const units = reportData.unitUsaha || [];
            const ws_data = [
                ['DATA UNIT USAHA BUMDes - KEMENTERIAN DESA PDTT'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['No', 'Nama Unit', 'Jenis Usaha', 'Modal Awal (Rp)', 'Omzet Bulanan (Rp)', 'Jumlah Karyawan', 'Status', 'Deskripsi']
            ];
            
            units.forEach((unit, index) => {
                ws_data.push([
                    index + 1,
                    unit.namaUnit || '',
                    unit.jenisUsaha || '',
                    unit.modalAwalUnit || '',
                    unit.omzetBulanan || '',
                    unit.jumlahKaryawanUnit || '',
                    unit.statusOperasional || '',
                    unit.deskripsiUsaha || ''
                ]);
            });
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Unit Usaha');
            XLSX.writeFile(wb, 'Unit_Usaha_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📊 Data Unit Usaha berhasil di-export!');
        }

        function exportSDMData() {
            const data = reportData.sdm || {};
            const pengurus = data.pengurus || [];
            
            const ws_data = [
                ['DATA SDM & KEPENGURUSAN BUMDes - KEMENTERIAN DESA PDTT'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['DATA PENGURUS'],
                ['No', 'Nama Lengkap', 'Jabatan', 'Pendidikan Terakhir']
            ];
            
            pengurus.forEach((p, index) => {
                ws_data.push([
                    index + 1,
                    p.namaPengurus || '',
                    p.jabatanPengurus || '',
                    p.pendidikanPengurus || ''
                ]);
            });
            
            ws_data.push(
                [''],
                ['DATA KARYAWAN'],
                ['Karyawan Tetap', data.karyawanTetap || ''],
                ['Karyawan Kontrak', data.karyawanKontrak || ''],
                ['Karyawan Laki-laki', data.karyawanLaki || ''],
                ['Karyawan Perempuan', data.karyawanPerempuan || ''],
                [''],
                ['PELATIHAN & PENGEMBANGAN'],
                ['Jumlah Pelatihan per Tahun', data.jumlahPelatihan || ''],
                ['Anggaran Pelatihan (Rp)', data.anggaranPelatihan || ''],
                ['Jenis Pelatihan', data.jenisPelatihan || '']
            );
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'SDM & Kepengurusan');
            XLSX.writeFile(wb, 'SDM_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📊 Data SDM berhasil di-export!');
        }

        function exportDampakData() {
            const data = reportData.dampak || {};
            const ws_data = [
                ['DAMPAK SOSIAL EKONOMI BUMDes - KEMENTERIAN DESA PDTT'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['DAMPAK EKONOMI'],
                ['Lapangan Kerja yang Tercipta', data.lapanganKerja || ''],
                ['Peningkatan Pendapatan Masyarakat (%)', data.peningkatanPendapatan || ''],
                ['Kontribusi PADes (Rp/tahun)', data.kontribusiPADes || ''],
                ['Jumlah UMKM yang Bermitra', data.umkmBermitra || ''],
                [''],
                ['DAMPAK SOSIAL'],
                ['Jumlah Keluarga yang Terlayani', data.keluargaTerlayani || ''],
                ['Program CSR yang Dilaksanakan', data.programCSR || ''],
                ['Anggaran CSR (Rp/tahun)', data.anggaranCSR || ''],
                ['Tingkat Kepuasan Masyarakat (%)', data.kepuasanMasyarakat || ''],
                ['Deskripsi Program CSR', data.deskripsiCSR || ''],
                [''],
                ['DAMPAK LINGKUNGAN'],
                ['Program Pengelolaan Sampah', data.programSampah || ''],
                ['Volume Sampah Dikelola (Ton/bulan)', data.volumeSampah || ''],
                ['Program Penghijauan', data.programHijau || ''],
                ['Jumlah Pohon Ditanam (per tahun)', data.jumlahPohon || '']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Dampak Sosial Ekonomi');
            XLSX.writeFile(wb, 'Dampak_Sosial_Ekonomi_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📊 Data Dampak Sosial Ekonomi berhasil di-export!');
        }

        // Comprehensive export functions
        function exportLaporanLengkap() {
            const wb = XLSX.utils.book_new();
            
            // Sheet 1: Profil
            const profilData = reportData.profil || {};
            const profilSheet = [
                ['PROFIL BUMDes'],
                ['Nama BUMDes', profilData.namaBumdes || ''],
                ['Nama Desa', profilData.namaDesa || ''],
                ['Kecamatan', profilData.kecamatan || ''],
                ['Kabupaten/Kota', profilData.kabupaten || ''],
                ['Provinsi', profilData.provinsi || ''],
                ['Tanggal Berdiri', profilData.tanggalBerdiri || ''],
                ['Modal Awal (Rp)', profilData.modalAwal || '']
            ];
            const ws1 = XLSX.utils.aoa_to_sheet(profilSheet);
            XLSX.utils.book_append_sheet(wb, ws1, 'Profil');
            
            // Sheet 2: Keuangan
            const keuanganData = reportData.keuangan || {};
            const keuanganSheet = [
                ['LAPORAN KEUANGAN'],
                ['Total Pendapatan (Rp)', keuanganData.totalPendapatan || ''],
                ['Harga Pokok Penjualan (Rp)', keuanganData.hpp || ''],
                ['Biaya Operasional (Rp)', keuanganData.biayaOperasional || ''],
                ['Kas (Rp)', keuanganData.kas || ''],
                ['Aset Tetap (Rp)', keuanganData.asetTetap || '']
            ];
            const ws2 = XLSX.utils.aoa_to_sheet(keuanganSheet);
            XLSX.utils.book_append_sheet(wb, ws2, 'Keuangan');
            
            // Sheet 3: Unit Usaha
            const unitData = reportData.unitUsaha || [];
            const unitSheet = [
                ['UNIT USAHA'],
                ['No', 'Nama Unit', 'Jenis Usaha', 'Omzet Bulanan']
            ];
            unitData.forEach((unit, index) => {
                unitSheet.push([
                    index + 1,
                    unit.namaUnit || '',
                    unit.jenisUsaha || '',
                    unit.omzetBulanan || ''
                ]);
            });
            const ws3 = XLSX.utils.aoa_to_sheet(unitSheet);
            XLSX.utils.book_append_sheet(wb, ws3, 'Unit Usaha');
            
            XLSX.writeFile(wb, 'Laporan_Lengkap_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            alert('📊 Laporan lengkap berhasil di-export ke Excel!');
        }

        function exportLaporanPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(16);
            doc.text('LAPORAN BUMDes UNTUK KEMENTERIAN DESA PDTT', 20, 20);
            doc.setFontSize(12);
            doc.text('Tanggal: ' + new Date().toLocaleDateString('id-ID'), 20, 35);
            
            let y = 50;
            
            // Profil
            const profil = reportData.profil || {};
            doc.setFontSize(14);
            doc.text('PROFIL BUMDes', 20, y);
            y += 10;
            doc.setFontSize(10);
            doc.text('Nama BUMDes: ' + (profil.namaBumdes || ''), 20, y);
            y += 7;
            doc.text('Desa: ' + (profil.namaDesa || ''), 20, y);
            y += 7;
            doc.text('Kecamatan: ' + (profil.kecamatan || ''), 20, y);
            y += 7;
            doc.text('Kabupaten: ' + (profil.kabupaten || ''), 20, y);
            y += 15;
            
            // Keuangan
            const keuangan = reportData.keuangan || {};
            doc.setFontSize(14);
            doc.text('LAPORAN KEUANGAN', 20, y);
            y += 10;
            doc.setFontSize(10);
            doc.text('Total Pendapatan: Rp ' + (parseInt(keuangan.totalPendapatan || 0).toLocaleString('id-ID')), 20, y);
            y += 7;
            doc.text('Kas: Rp ' + (parseInt(keuangan.kas || 0).toLocaleString('id-ID')), 20, y);
            y += 7;
            doc.text('Aset Tetap: Rp ' + (parseInt(keuangan.asetTetap || 0).toLocaleString('id-ID')), 20, y);
            
            doc.save('Laporan_BUMDes_Kemendes_' + new Date().toISOString().split('T')[0] + '.pdf');
            alert('📄 Laporan PDF berhasil di-export!');
        }

        function exportFormatKemendes() {
            const wb = XLSX.utils.book_new();
            
            // Format sesuai standar Kementerian Desa
            const formatKemendes = [
                ['LAPORAN BUMDes KEPADA KEMENTERIAN DESA PDTT'],
                ['Periode:', new Date().getFullYear()],
                [''],
                ['I. IDENTITAS BUMDes'],
                ['Nama BUMDes', reportData.profil?.namaBumdes || ''],
                ['Desa', reportData.profil?.namaDesa || ''],
                ['Kecamatan', reportData.profil?.kecamatan || ''],
                ['Kabupaten/Kota', reportData.profil?.kabupaten || ''],
                ['Provinsi', reportData.profil?.provinsi || ''],
                ['Tanggal Berdiri', reportData.profil?.tanggalBerdiri || ''],
                ['No. SK Pendirian', reportData.profil?.noSK || ''],
                [''],
                ['II. KINERJA KEUANGAN'],
                ['Total Aset (Rp)', (parseInt(reportData.keuangan?.kas || 0) + parseInt(reportData.keuangan?.asetTetap || 0)).toLocaleString('id-ID')],
                ['Total Pendapatan (Rp)', parseInt(reportData.keuangan?.totalPendapatan || 0).toLocaleString('id-ID')],
                ['Laba Bersih (Rp)', 'Dihitung otomatis'],
                [''],
                ['III. UNIT USAHA'],
                ['Jumlah Unit Usaha', reportData.unitUsaha?.length || 0],
                ['Unit Aktif', reportData.unitUsaha?.filter(u => u.statusOperasional === 'aktif').length || 0],
                [''],
                ['IV. SUMBER DAYA MANUSIA'],
                ['Jumlah Pengurus', reportData.sdm?.pengurus?.length || 0],
                ['Jumlah Karyawan', (parseInt(reportData.sdm?.karyawanTetap || 0) + parseInt(reportData.sdm?.karyawanKontrak || 0))],
                [''],
                ['V. DAMPAK SOSIAL EKONOMI'],
                ['Lapangan Kerja Tercipta', reportData.dampak?.lapanganKerja || 0],
                ['Keluarga Terlayani', reportData.dampak?.keluargaTerlayani || 0],
                ['Kontribusi PADes (Rp)', parseInt(reportData.dampak?.kontribusiPADes || 0).toLocaleString('id-ID')],
                [''],
                ['VI. KESIMPULAN'],
                ['Status BUMDes', reportData.profil?.statusBumdes || 'Aktif'],
                ['Rekomendasi', 'BUMDes berkembang dengan baik dan memberikan dampak positif bagi masyarakat desa']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(formatKemendes);
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Kemendes');
            XLSX.writeFile(wb, 'Format_Kemendes_BUMDes_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('🏛️ Laporan format Kementerian Desa berhasil di-export!');
        }

        // Unit reporting functions
        function refreshUnitList() {
            const unitSelect = document.getElementById('selectedUnit');
            const units = reportData.unitUsaha || [];
            
            // Clear existing options
            unitSelect.innerHTML = '<option value="">-- Pilih Unit Usaha --</option>';
            
            // Add units
            units.forEach((unit, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = unit.namaUnit || `Unit ${index + 1}`;
                unitSelect.appendChild(option);
            });
            
            // Update unit reports list
            updateUnitReportsList();
            
            alert('🔄 Daftar unit usaha berhasil di-refresh!');
        }

        function loadUnitReport() {
            const selectedIndex = document.getElementById('selectedUnit').value;
            const unitForm = document.getElementById('unitReportForm');
            
            if (selectedIndex === '') {
                unitForm.classList.add('hidden');
                return;
            }
            
            const units = reportData.unitUsaha || [];
            const selectedUnit = units[selectedIndex];
            
            if (selectedUnit) {
                // Show form
                unitForm.classList.remove('hidden');
                
                // Fill unit info
                document.getElementById('unitNama').value = selectedUnit.namaUnit || '';
                document.getElementById('unitJenis').value = selectedUnit.jenisUsaha || '';
                
                // Set current month as default
                const currentDate = new Date();
                const currentMonth = currentDate.toISOString().slice(0, 7);
                document.getElementById('periodeUnit').value = currentMonth;
                
                // Load existing report if available
                const unitReports = reportData.unitReports || {};
                const reportKey = `${selectedIndex}_${currentMonth}`;
                const existingReport = unitReports[reportKey];
                
                if (existingReport) {
                    // Fill form with existing data
                    document.getElementById('unitPenjualan').value = existingReport.penjualan || '';
                    document.getElementById('unitPendapatanJasa').value = existingReport.pendapatanJasa || '';
                    document.getElementById('unitPendapatanLain').value = existingReport.pendapatanLain || '';
                    document.getElementById('unitHPP').value = existingReport.hpp || '';
                    document.getElementById('unitBiayaGaji').value = existingReport.biayaGaji || '';
                    document.getElementById('unitBiayaOp').value = existingReport.biayaOp || '';
                    document.getElementById('unitBiayaAdmin').value = existingReport.biayaAdmin || '';
                    document.getElementById('unitBiayaPemasaran').value = existingReport.biayaPemasaran || '';
                    document.getElementById('unitKas').value = existingReport.kas || '';
                    document.getElementById('unitPiutang').value = existingReport.piutang || '';
                    document.getElementById('unitPersediaan').value = existingReport.persediaan || '';
                    document.getElementById('unitAsetTetap').value = existingReport.asetTetap || '';
                    document.getElementById('unitCatatan').value = existingReport.catatan || '';
                    document.getElementById('unitRencana').value = existingReport.rencana || '';
                    
                    // Calculate automatically
                    hitungLabaUnit();
                } else {
                    // Clear form for new report
                    clearUnitForm();
                }
            }
        }

        function clearUnitForm() {
            const inputs = ['unitPenjualan', 'unitPendapatanJasa', 'unitPendapatanLain', 'unitHPP', 
                           'unitBiayaGaji', 'unitBiayaOp', 'unitBiayaAdmin', 'unitBiayaPemasaran',
                           'unitKas', 'unitPiutang', 'unitPersediaan', 'unitAsetTetap', 
                           'unitCatatan', 'unitRencana'];
            
            inputs.forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // Reset calculated fields
            document.getElementById('unitTotalPendapatan').value = '';
            document.getElementById('unitTotalBiaya').value = '';
            document.getElementById('unitLabaKotor').textContent = 'Rp 0';
            document.getElementById('unitLabaOp').textContent = 'Rp 0';
            document.getElementById('unitLabaBersih').textContent = 'Rp 0';
        }

        function hitungLabaUnit() {
            const penjualan = parseInt(document.getElementById('unitPenjualan').value) || 0;
            const pendapatanJasa = parseInt(document.getElementById('unitPendapatanJasa').value) || 0;
            const pendapatanLain = parseInt(document.getElementById('unitPendapatanLain').value) || 0;
            const hpp = parseInt(document.getElementById('unitHPP').value) || 0;
            const biayaGaji = parseInt(document.getElementById('unitBiayaGaji').value) || 0;
            const biayaOp = parseInt(document.getElementById('unitBiayaOp').value) || 0;
            const biayaAdmin = parseInt(document.getElementById('unitBiayaAdmin').value) || 0;
            const biayaPemasaran = parseInt(document.getElementById('unitBiayaPemasaran').value) || 0;
            
            const totalPendapatan = penjualan + pendapatanJasa + pendapatanLain;
            const totalBiaya = hpp + biayaGaji + biayaOp + biayaAdmin + biayaPemasaran;
            const labaKotor = penjualan - hpp;
            const labaOp = totalPendapatan - hpp - biayaOp - biayaAdmin - biayaPemasaran;
            const labaBersih = totalPendapatan - totalBiaya;
            
            // Update display
            document.getElementById('unitTotalPendapatan').value = totalPendapatan;
            document.getElementById('unitTotalBiaya').value = totalBiaya;
            document.getElementById('unitLabaKotor').textContent = 'Rp ' + labaKotor.toLocaleString('id-ID');
            document.getElementById('unitLabaOp').textContent = 'Rp ' + labaOp.toLocaleString('id-ID');
            document.getElementById('unitLabaBersih').textContent = 'Rp ' + labaBersih.toLocaleString('id-ID');
        }

        function saveUnitReport(event) {
            event.preventDefault();
            
            const selectedIndex = document.getElementById('selectedUnit').value;
            const periode = document.getElementById('periodeUnit').value;
            
            if (!selectedIndex || !periode) {
                alert('❌ Pilih unit usaha dan periode terlebih dahulu!');
                return;
            }
            
            const reportData_local = {
                unitIndex: selectedIndex,
                unitNama: document.getElementById('unitNama').value,
                unitJenis: document.getElementById('unitJenis').value,
                periode: periode,
                penjualan: document.getElementById('unitPenjualan').value,
                pendapatanJasa: document.getElementById('unitPendapatanJasa').value,
                pendapatanLain: document.getElementById('unitPendapatanLain').value,
                hpp: document.getElementById('unitHPP').value,
                biayaGaji: document.getElementById('unitBiayaGaji').value,
                biayaOp: document.getElementById('unitBiayaOp').value,
                biayaAdmin: document.getElementById('unitBiayaAdmin').value,
                biayaPemasaran: document.getElementById('unitBiayaPemasaran').value,
                kas: document.getElementById('unitKas').value,
                piutang: document.getElementById('unitPiutang').value,
                persediaan: document.getElementById('unitPersediaan').value,
                asetTetap: document.getElementById('unitAsetTetap').value,
                catatan: document.getElementById('unitCatatan').value,
                rencana: document.getElementById('unitRencana').value,
                tanggalInput: new Date().toISOString()
            };
            
            // Initialize unitReports if not exists
            if (!reportData.unitReports) {
                reportData.unitReports = {};
            }
            
            // Save report with unique key
            const reportKey = `${selectedIndex}_${periode}`;
            reportData.unitReports[reportKey] = reportData_local;
            
            // Save to localStorage
            localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
            
            // Update reports list
            updateUnitReportsList();
            
            alert('💾 Laporan unit usaha berhasil disimpan!');
        }

        function updateUnitReportsList() {
            const container = document.getElementById('unitReportsList');
            const unitReports = reportData.unitReports || {};
            
            if (Object.keys(unitReports).length === 0) {
                container.innerHTML = '<p class="text-gray-600 text-center py-4">Belum ada laporan unit yang tersimpan</p>';
                return;
            }
            
            let html = '<div class="space-y-3">';
            
            Object.entries(unitReports).forEach(([key, report]) => {
                const totalPendapatan = (parseInt(report.penjualan || 0) + parseInt(report.pendapatanJasa || 0) + parseInt(report.pendapatanLain || 0));
                const totalBiaya = (parseInt(report.hpp || 0) + parseInt(report.biayaGaji || 0) + parseInt(report.biayaOp || 0) + parseInt(report.biayaAdmin || 0) + parseInt(report.biayaPemasaran || 0));
                const labaBersih = totalPendapatan - totalBiaya;
                
                html += `
                    <div class="bg-white p-4 rounded-lg border">
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="font-semibold text-gray-800">${report.unitNama}</h5>
                                <p class="text-sm text-gray-600">Periode: ${report.periode}</p>
                                <p class="text-sm text-gray-600">Jenis: ${report.unitJenis}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Laba Bersih</p>
                                <p class="font-bold ${labaBersih >= 0 ? 'text-green-600' : 'text-red-600'}">
                                    Rp ${labaBersih.toLocaleString('id-ID')}
                                </p>
                            </div>
                        </div>
                        <div class="mt-3 flex space-x-2">
                            <button onclick="editUnitReport('${key}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                ✏️ Edit
                            </button>
                            <button onclick="deleteUnitReport('${key}')" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                🗑️ Hapus
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function editUnitReport(reportKey) {
            const unitReports = reportData.unitReports || {};
            const report = unitReports[reportKey];
            
            if (!report) return;
            
            // Set unit selector
            document.getElementById('selectedUnit').value = report.unitIndex;
            
            // Load the report
            loadUnitReport();
            
            // Scroll to form
            document.getElementById('unitReportForm').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteUnitReport(reportKey) {
            if (confirm('❓ Apakah Anda yakin ingin menghapus laporan ini?')) {
                delete reportData.unitReports[reportKey];
                localStorage.setItem('bumdesKemendesReports', JSON.stringify(reportData));
                updateUnitReportsList();
                alert('🗑️ Laporan berhasil dihapus!');
            }
        }

        function exportUnitReport() {
            const selectedIndex = document.getElementById('selectedUnit').value;
            const periode = document.getElementById('periodeUnit').value;
            
            if (!selectedIndex || !periode) {
                alert('❌ Pilih unit usaha dan periode terlebih dahulu!');
                return;
            }
            
            const reportKey = `${selectedIndex}_${periode}`;
            const unitReports = reportData.unitReports || {};
            const report = unitReports[reportKey];
            
            if (!report) {
                alert('❌ Laporan belum disimpan!');
                return;
            }
            
            const ws_data = [
                ['LAPORAN KEUANGAN UNIT USAHA - KEMENTERIAN DESA PDTT'],
                ['Nama Unit', report.unitNama],
                ['Jenis Usaha', report.unitJenis],
                ['Periode', report.periode],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['PENDAPATAN'],
                ['Penjualan/Omzet (Rp)', report.penjualan || 0],
                ['Pendapatan Jasa (Rp)', report.pendapatanJasa || 0],
                ['Pendapatan Lain-lain (Rp)', report.pendapatanLain || 0],
                ['Total Pendapatan (Rp)', (parseInt(report.penjualan || 0) + parseInt(report.pendapatanJasa || 0) + parseInt(report.pendapatanLain || 0))],
                [''],
                ['BIAYA'],
                ['Harga Pokok Penjualan (Rp)', report.hpp || 0],
                ['Biaya Gaji Karyawan (Rp)', report.biayaGaji || 0],
                ['Biaya Operasional (Rp)', report.biayaOp || 0],
                ['Biaya Administrasi (Rp)', report.biayaAdmin || 0],
                ['Biaya Pemasaran (Rp)', report.biayaPemasaran || 0],
                ['Total Biaya (Rp)', (parseInt(report.hpp || 0) + parseInt(report.biayaGaji || 0) + parseInt(report.biayaOp || 0) + parseInt(report.biayaAdmin || 0) + parseInt(report.biayaPemasaran || 0))],
                [''],
                ['LABA RUGI'],
                ['Laba Kotor (Rp)', (parseInt(report.penjualan || 0) - parseInt(report.hpp || 0))],
                ['Laba Bersih (Rp)', ((parseInt(report.penjualan || 0) + parseInt(report.pendapatanJasa || 0) + parseInt(report.pendapatanLain || 0)) - (parseInt(report.hpp || 0) + parseInt(report.biayaGaji || 0) + parseInt(report.biayaOp || 0) + parseInt(report.biayaAdmin || 0) + parseInt(report.biayaPemasaran || 0)))],
                [''],
                ['ASET UNIT'],
                ['Kas Unit (Rp)', report.kas || 0],
                ['Piutang Unit (Rp)', report.piutang || 0],
                ['Persediaan Unit (Rp)', report.persediaan || 0],
                ['Aset Tetap Unit (Rp)', report.asetTetap || 0],
                [''],
                ['CATATAN'],
                ['Catatan Kinerja', report.catatan || ''],
                ['Rencana Pengembangan', report.rencana || '']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Unit');
            XLSX.writeFile(wb, `Laporan_${report.unitNama}_${report.periode}.xlsx`);
            
            alert('📊 Laporan unit berhasil di-export!');
        }

        function exportAllUnitReports() {
            const unitReports = reportData.unitReports || {};
            
            if (Object.keys(unitReports).length === 0) {
                alert('❌ Belum ada laporan unit yang tersimpan!');
                return;
            }
            
            const wb = XLSX.utils.book_new();
            
            // Summary sheet
            const summaryData = [
                ['RINGKASAN LAPORAN SEMUA UNIT USAHA'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['Unit', 'Periode', 'Total Pendapatan', 'Total Biaya', 'Laba Bersih']
            ];
            
            Object.entries(unitReports).forEach(([key, report]) => {
                const totalPendapatan = (parseInt(report.penjualan || 0) + parseInt(report.pendapatanJasa || 0) + parseInt(report.pendapatanLain || 0));
                const totalBiaya = (parseInt(report.hpp || 0) + parseInt(report.biayaGaji || 0) + parseInt(report.biayaOp || 0) + parseInt(report.biayaAdmin || 0) + parseInt(report.biayaPemasaran || 0));
                const labaBersih = totalPendapatan - totalBiaya;
                
                summaryData.push([
                    report.unitNama,
                    report.periode,
                    totalPendapatan,
                    totalBiaya,
                    labaBersih
                ]);
            });
            
            const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, 'Ringkasan');
            
            XLSX.writeFile(wb, 'Laporan_Semua_Unit_' + new Date().toISOString().split('T')[0] + '.xlsx');
            alert('📊 Semua laporan unit berhasil di-export!');
        }

        function generateConsolidatedReport() {
            const unitReports = reportData.unitReports || {};
            
            if (Object.keys(unitReports).length === 0) {
                alert('❌ Belum ada laporan unit yang tersimpan!');
                return;
            }
            
            let totalPendapatanAll = 0;
            let totalBiayaAll = 0;
            let totalLabaAll = 0;
            
            const ws_data = [
                ['LAPORAN KONSOLIDASI SEMUA UNIT USAHA'],
                ['BUMDes Cikahuripan Makmur Mandiri Sejahtera Cikahuripan'],
                ['Tanggal Export', new Date().toLocaleDateString('id-ID')],
                [''],
                ['DETAIL PER UNIT']
            ];
            
            Object.entries(unitReports).forEach(([key, report]) => {
                const totalPendapatan = (parseInt(report.penjualan || 0) + parseInt(report.pendapatanJasa || 0) + parseInt(report.pendapatanLain || 0));
                const totalBiaya = (parseInt(report.hpp || 0) + parseInt(report.biayaGaji || 0) + parseInt(report.biayaOp || 0) + parseInt(report.biayaAdmin || 0) + parseInt(report.biayaPemasaran || 0));
                const labaBersih = totalPendapatan - totalBiaya;
                
                totalPendapatanAll += totalPendapatan;
                totalBiayaAll += totalBiaya;
                totalLabaAll += labaBersih;
                
                ws_data.push(
                    [''],
                    [`Unit: ${report.unitNama} (${report.periode})`],
                    ['Total Pendapatan (Rp)', totalPendapatan],
                    ['Total Biaya (Rp)', totalBiaya],
                    ['Laba Bersih (Rp)', labaBersih]
                );
            });
            
            ws_data.push(
                [''],
                ['TOTAL KONSOLIDASI'],
                ['Total Pendapatan Semua Unit (Rp)', totalPendapatanAll],
                ['Total Biaya Semua Unit (Rp)', totalBiayaAll],
                ['Total Laba Bersih Semua Unit (Rp)', totalLabaAll]
            );
            
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Konsolidasi');
            XLSX.writeFile(wb, 'Laporan_Konsolidasi_' + new Date().toISOString().split('T')[0] + '.xlsx');
            
            alert('📈 Laporan konsolidasi berhasil dibuat!');
        }

        function validateAllData() {
            const validationResults = document.getElementById('validationResults');
            let results = [];
            
            // Validasi Profil
            if (reportData.profil && reportData.profil.namaBumdes) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Data Profil BUMDes: Lengkap</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-red-600 mr-2">❌</span><span>Data Profil BUMDes: Belum Lengkap</span></div>');
            }
            
            // Validasi Keuangan
            if (reportData.keuangan && reportData.keuangan.totalPendapatan) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Laporan Keuangan: Lengkap</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-red-600 mr-2">❌</span><span>Laporan Keuangan: Belum Lengkap</span></div>');
            }
            
            // Validasi Unit Usaha
            if (reportData.unitUsaha && reportData.unitUsaha.length > 0) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Data Unit Usaha: Lengkap (' + reportData.unitUsaha.length + ' unit)</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-red-600 mr-2">❌</span><span>Data Unit Usaha: Belum Lengkap</span></div>');
            }
            
            // Validasi Laporan Unit
            const unitReportsCount = reportData.unitReports ? Object.keys(reportData.unitReports).length : 0;
            if (unitReportsCount > 0) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Laporan per Unit: ' + unitReportsCount + ' laporan tersimpan</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-yellow-600 mr-2">⚠️</span><span>Laporan per Unit: Belum ada laporan</span></div>');
            }
            
            // Validasi SDM
            if (reportData.sdm && reportData.sdm.pengurus) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Data SDM: Lengkap</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-red-600 mr-2">❌</span><span>Data SDM: Belum Lengkap</span></div>');
            }
            
            // Validasi Dampak
            if (reportData.dampak && reportData.dampak.lapanganKerja) {
                results.push('<div class="flex items-center"><span class="text-green-600 mr-2">✅</span><span>Data Dampak Sosial Ekonomi: Lengkap</span></div>');
            } else {
                results.push('<div class="flex items-center"><span class="text-red-600 mr-2">❌</span><span>Data Dampak Sosial Ekonomi: Belum Lengkap</span></div>');
            }
            
            validationResults.innerHTML = '<div class="space-y-2">' + results.join('') + '</div>';
            
            alert('🔍 Validasi data selesai! Periksa hasil di bawah.');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976cdcfdf216f8c4',t:'MTc1NjQ3OTA1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

